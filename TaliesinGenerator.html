<!DOCTYPE html>
<html lang="en">

 <head>
  <meta charset="utf-8">
  <title>Taliesin D&D Character Generator</title>
  <link rel="stylesheet" type="text/css" href="https://edwardtufte.github.io/tufte-css/tufte.css"/>
 </head>

 <!-- The layout of the page, and containers. -->

 <body>
     <h1>Your Character</h1>

     <table class='header'>
         <tr>
             <td class='oracle'><h3 id="copy"></h3></td>
             <td class='commentary'><div>Give your character a name:</div>
                <input type="text" id="charname">
                <button onclick="changeName()" value="">Name them now.</button>
            </td>
         </tr>
     </table>
     
     <!-- The ability scores. -->

     <br />
     <table class="attr">
        <tbody>
            <tr>
                <td>Strength</td>
                <td id='str'>__</td>
                <td class='comments' id='strCommentary'></td>
            </tr>
            <tr></tr>
                <td>Intelligence</td>
                <td id='int'>__</td>
                <td class='comments' id='intCommentary'></td>
            </tr>
            <tr>
                <td>Wisdom</td>
                <td id='wis'>__</td>
                <td class='comments' id='wisCommentary'></td>
            </tr>
            <tr>
                <td>Dexterity</td>
                <td id='dex'>__</td>
                <td class='comments' id='dexCommentary'></td>
            </tr>
            <tr>
                <td>Constitution</td>
                <td id='con'>__</td>
                <td class='comments' id='conCommentary'></td>
            </tr>
            <tr>
                <td>Charisma</td>
                <td id='cha'>__</td>
                <td class='comments' id='chaCommentary'></td>
            </tr>
        </tbody>
    </table>

    <!-- Features -->

    <h2>Features</h2>
    <table class='featdice'>
        <tr>
            <td>A Most Particular Expertise:</td>
            <td id='featdice1'></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>A Nose for Danger:</td>
            <td id='featdice2'></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>Well Equipped:</td>
            <td id='featdice3'></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>Tough as Nails:</td>
            <td id='featdice4'></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>The Gods Smile Upon You:</td>
            <td id='featdice5'></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>Touched by the Beyond:</td>
            <td id='featdice6'></td>
            <td></td>
            <td></td>
        </tr>
    </table>
     <br />
     <br />

     <!-- The secondary statistics -->

    <table class='secondary'>
         <tr>
             <td>Fate:</td>
             <td id='fate'>8</td>
             <td class='comments' id='fatecommentary'></td>
         </tr>
         <tr>
             <td>Hit Dice:</td>
             <td id='hitdice'>d4</td>
             <td class='comments' id='hitdicecommentary'></td>
         </tr>
         <tr>
            <td>Attack:</td>
            <td id='attack'>11</td>
            <td class='comments' id='attackcommentary'></td>
        </tr>
        <tr>
            <td>Defend:</td>
            <td id='defend'>11</td>
            <td class='comments' id='defendcommentary'></td>
         </tr>
     </table>
     <br />
     <br />

     <!-- Unfinished: equipment, spells, and questionnaire. -->

     <div>You are carrying:</div>
     <p id="equip">Your equipment will go here.</p>
     <div>You know the following spells:</div>
     <p id="magic">Your spells will go here.</p>
     <div>Your max load is:</div>
     <p id="load">__</p>

     <!-- Your future -->

     <p id="future">Your future: you can go on to become a Vagabond</p>
 </body>

 <!-- This formats the 'commentary' class. -->

 <style>
     .commentary {
         font-size: 12px;
         color: grey;
         font-style: italic;
     }
     h2 {
         text-align: center;
         width: 30em;
         font-size: 1.7em;
     }
     h3 {
         font-size: 1em;
     }

    /* Buttons */

    button {
        font-family: et-book, Palatino, sans-serif;
        font-size: 1rem;
        margin-top: 1rem;
        margin-bottom: 1rem;
    }
        
    /* Various Tables */

    table {
        padding: 0.5em;
        border-bottom: 1px solid #333;
        border-spacing: 0;
        font-size: 1.7rem;
    }
    table td,
    table th {
        width: 8em;
        vertical-align: top;
        text-align: left;
        padding: 0;
    }
    table td.oracle{
        width: 42em;
        padding-right: 50px;
        font-size: 1.2rem;
    }
    table td.comments{
        font-size: 1rem;
        font-style: italic;
        width: 40em;
        vertical-align: middle;
    }
    table.header {
        border-bottom: none;
    }
    table.attr {
        border-top: 1px solid #333;
    }
    table.featdice {
        border-bottom: none;
        font-size: 18px;
        width: 100%;
    }
    table.secondary {
        border-top: 1px solid #333;
        font-size: 1.4rem;
        width: 42em;
        padding-right: 50px;
    }
 </style>


<!-- References to linked JS scripts.-->

<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
<script src="gamemechanics.js"></script>
<script src="contentlists.js"></script>
<script src="stat-modifiers.js"></script>

<!-- Code for updating the page dynamically. -->

<script>

    document.getElementById('copy').innerHTML += _.sample(characterTraits);
    
    document.getElementById('equip').innerText = _.sampleSize(basicEquipment, 2);
    document.getElementById('magic').innerText = _.sampleSize(ethericFormulae, 2);

    let stats = ['str', 'int', 'wis', 'dex', 'con', 'cha'];
    let statsTotal = 0;
    let featureDice = 0;
    
    // Code for updating hit dice will need to take into account 1) your Constitution, and 2) your Background
    // - if you have none, it is a d6.

    // Determine ability scores.

    for (const statName of stats){
        let tempscore = rollStat();
        document.getElementById(statName).innerText = tempscore;
        statsTotal += tempscore;
    }

    // Determine ability modifiers.

    strBonuses(parseInt(document.getElementById('str').innerText));
    intBonuses(parseInt(document.getElementById('int').innerText));
    wisBonuses(parseInt(document.getElementById('wis').innerText));
    dexBonuses(parseInt(document.getElementById('dex').innerText));
    conBonuses(parseInt(document.getElementById('con').innerText));
    chaBonuses(parseInt(document.getElementById('cha').innerText));

    // Calculate Feature dice.

    for (const statName of stats){
        let statScore = parseInt(document.getElementById(statName).innerText);
        getFeatureDice(statScore);
    }

    // Old code --- featureDice = parseInt(document.getElementById('featdice').innerText);

    determineTotalFeatureDice(featureDice, statsTotal);

    // Roll Feature dice (prints in console).

    // Old code --- featureDice = parseInt(document.getElementById('featdice').innerText);

    console.log("Your character has " + featureDice + " Feature dice. Congrats!!!")

    featureDice = rollFeatures(featureDice);

    sortFeatDice(featureDice);

    // Removes extra commas.

    cleanFeatDice();

    // Load is based on Strength.

    defineLoad(parseInt(document.getElementById('str').innerText));

    // This functions changes the character's name.

    function changeName(){
        document.getElementsByTagName('h1')[0].innerHTML = document.getElementById('charname').value;
    }

    // This function determines the character's future.
    
    function listFuture(){

        let str, int;
        str = document.getElementById('str').innerText;
        int = document.getElementById('int').innerText;
        console.log("Your Strength is " + str + " and your Int is " + int);

        if (str > 8 && int < 11) {
            document.getElementById('future').innerText += " or a Warrior.";
        }
        if (str < 9 && int < 11) {
            document.getElementById('future').innerText = "You have always been, and will always remain, a Vagabond.";
        }
        if (str > 8 && int > 10) {
            document.getElementById('future').innerText += ", a Warrior, or an Arcanist.";
        }
        if (str < 9 && int > 10) {
            document.getElementById('future').innerText += " or an Arcanist.";
        }
    }

    listFuture();

</script>